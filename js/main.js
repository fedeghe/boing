!function(){var NS={};~function(){var gameProto,_mobile=LIB.util.isMobile(),_video=!0,_bEvent=_mobile?"touchstart":"click",_baseEndPhrase="<i>You</i> need",_endPhrases="skills|focus|passion|the right partner|the essential|another perspective|to go further".split("|"),_lifeUpCutoff=1e5,_icon,_currentPowerUp,_loadingDiv='<div class="loading"></div>',_powerAppearDelay=[2,5];LIB.events.avoidVerticalScroll(),LIB.css.fontAwesome(),NS.Game=function(){this.canvas=null,this.ctx=null,this.score=0,this.infoPanelVisible=!1,this.start()},gameProto=NS.Game.prototype,gameProto._currentPowerup=!1,gameProto._icon=!1,gameProto.start=function(){NS.s.reset(),LIB.Channel("boing").reset(),this.viewport=LIB.util.getViewportSize(),this.createPlayground().renderPanels().gameReady(),LIB.events.disableRightClick(),console.log("game started")},gameProto.createPlayground=function(){var e=this;return LIB.Widgzard.render({content:[{attrs:{class:"logo"}},{tag:"canvas",wid:"canvas",attrs:{width:e.viewport.width,height:e.viewport.height},style:{position:"absolute",top:"0px",left:"0px",opacity:0},cb:function(){var n=this,t=n.node,o=e.viewport.width/(_mobile?10:25);e.I=new Image,e.I.width=e.I.height=o,LIB.css.style(e.I,{width:o+"px",height:o+"px"}),e.I.onload=function(){function i(n){var t=LIB.events.coord(n),o=t[0],i=e.viewport.width/2-o;l+=50*i/e.viewport.width,s()}function s(){console.log("start"),LIB.Channel("boing").pub("start");var i,s,u,h,g,p=0,b=0,f=.1,v=!1,I=!0,m=function(){v=!0,e.speedX=l+p*e.accX,e.speedY=d+p*e.accY,i=r+p*l+.5*p*p*e.accX,s=c+p*d+.5*p*p*e.accY,a.clearRect(0,0,t.width,t.height),h=e.speedX,g=(b+p*h)%360,LIB.canvas.drawRotatedImage(a,e.I,i,s,g,o),LIB.Channel("boing").pub("scoreUp",[f]),B(),p++},L=function(n){if(!I||!v)return!1;var t=LIB.events.coord(n),o=t[0]-e.I.width/2;l=l+50*(i-o)/e.viewport.width+Math.random()*(Math.random()>.5?-1:1),b=g,p=1,r=i,c=s,e.speedY<0?d*=1.02:d=-.95*e.speedY,LIB.Channel("boing").pub("scoreStore",[t[0]>r])},B=function(){(i+e.I.width/2<0||i+e.I.width/2>e.viewport.width||s+e.I.height/2>e.viewport.height)&&(clearInterval(u),LIB.events.off(t,_bEvent,L),LIB.Channel("boing").pub("collision"),v=!1),LIB.Channel("boing").pub("notifyPosition",[i,s]),s<0?(LIB.Channel("boing").pub("outNotifyShow",[i]),I=!1,f=1+-s/10):(LIB.Channel("boing").pub("outNotifyHide"),I=!0,f=.1)};n._icon=null,n._currentPowerUp=null,LIB.events.on(t,_bEvent,L),LIB.Channel("boing").sub("openHelp",function(){v=!1}),LIB.Channel("boing").sub("closeHelp",function(){v=!0}),u=window.setInterval(m,25)}var a=t.getContext("2d"),r=(e.viewport.width-e.I.width)/2,c=(e.viewport.height-e.I.height)/2,l=0,d=-20;a.imageSmoothingEnabled=!0,e.speedX=0,e.speedY=0,e.accX=0,e.accY=2,a.clearRect(0,0,t.width,t.height),a.drawImage(e.I,r,c,o,o),LIB.events.one(t,_bEvent,i)},e.I.src="css/img/daisy.svg",n.done()}},{tag:"audio",attrs:{controls:"",preload:"auto"},style:{display:"none"},content:[{tag:"source",attrs:{src:"media/boing1.m4a",type:"audio/mpeg"}},{tag:"source",attrs:{src:"media/boing1.ogg",type:"audio/ogg"}},{tag:"source",attrs:{src:"media/boing1.mp3",type:"audio/mpeg"}}],cb:function(){var e=this;e.node;LIB.Channel("boing").sub("boing",function(){var n=e.getNode("audioBag").node;LIB.Widgzard.render({target:n,content:[{tag:"audio",content:[{tag:"source",attrs:{src:"media/boing1.m4a",type:"audio/mpeg"}},{tag:"source",attrs:{src:"media/boing1.ogg",type:"audio/ogg"}},{tag:"source",attrs:{src:"media/boing1.mp3",type:"audio/mpeg"}}],end:function(){var e=this.node;LIB.events.on(e,"ended",function(){LIB.dom.remove(e)}),e.play()}}]},!0)}),this.done()}},{style:{display:"none"},wid:"audioBag"}],cb:function(){e.canvas=this.getNode("canvas").node,e.ctx=e.canvas.getContext("2d")}},!0),console.log("playground drawn"),this},gameProto.renderPanels=function(){var e=this,n={tag:"i",attrs:{class:"life"}};return lifesArr=function(){for(var e=[],t=3;--t;)e.push(n);return e}(),e.panel=LIB.Widgzard.render({content:[{style:{position:"absolute",top:"0px",width:"100%"},content:[{attrs:{class:"panel"},content:[{tag:"span",html:"SCORE: "},{tag:"span",style:{color:"black"},wid:"score",html:"0",init:function(){return!0},cb:function(){var n=this,t=n.node,o=0;LIB.Channel("boing").sub("scoreUp",function(n,i){e.score+=1*i,~~(e.score/_lifeUpCutoff)!=o&&(o++,LIB.Channel("boing").pub("lifeUp")),t.innerHTML=LIB.util.formatNumber(parseFloat(e.score.toFixed(1),10))}),n.done()}},{tag:"br"}]},{attrs:{class:"lifes"},wid:"lifes",content:lifesArr,cb:function(){var e=this,t=e.node;LIB.Channel("boing").sub("collision",function(){var e=t.childNodes;e.length?(LIB.Channel("boing").pub("lifeLost"),LIB.dom.remove(e[0])):LIB.Channel("boing").pub("gameOver")}),LIB.Channel("boing").sub("lifeUp",function(){LIB.Widgzard.render({target:t,content:[n,n],cb:function(){var e=t.childNodes;LIB.dom.remove(e[0])}})}),this.done()}},{wid:"powerup"}],cb:function(){var n=this,t=n.node;LIB.Channel("boing").sub("openHelp",function(){e.infoPanelVisible=!0,LIB.css.style(t,{opacity:.2})}),LIB.Channel("boing").sub("closeHelp",function(){e.infoPanelVisible=!1,LIB.css.style(t,{opacity:1})}),n.done()}},{attrs:{class:"help"},html:"?",cb:function(){var e=this,n=e.node;LIB.events.on(n,_bEvent,function(){LIB.css.style(n,{display:"none"}),LIB.Channel("boing").pub("openHelp")}),LIB.Channel("boing").sub("closeHelp",function(){LIB.css.style(n,{display:"block"})}),e.done()}},{wid:"helpWindow",attrs:{class:"infoWindow round round8"},content:[{attrs:{class:"closeButton"},html:"x",cb:function(){var n=this,t=n.node,o=function(){LIB.css.style(n.parent.node,{display:"none"}),LIB.Channel("boing").pub("closeHelp")};LIB.events.onEsc(o),LIB.events.on(t,_bEvent,o),LIB.Channel("boing").sub("openHelp",function(){e.infoPanelVisible=!0,LIB.css.style(n.parent.node,{display:"block"})}),this.done()}},{tag:"h2",html:"DAISY BOING v.0.1 <sub>158</sub>",style:{marginTop:"1.5em",textAlign:"center"}},{tag:"ul",content:[{tag:"li",html:"make the Daisy bounce as long & high as possible"},{tag:"li",html:"one tap to bounce, two tap to speed up"},{tag:"li",html:"avoid the ground and the walls"},{tag:"li",html:"the more You go out of screen the more You score"},{tag:"li",html:"gain 1up every 100k"}]},{tag:"button",attrs:{class:"round round4"},html:"OK",cb:function(){var e=this,n=e.node,t=function(){LIB.css.style(e.getNode("helpWindow").node,{display:"none"}),LIB.Channel("boing").pub("closeHelp")};LIB.events.on(n,_bEvent,t),this.done()}}]},{style:{display:"none"},attrs:{class:"lifeLost"},cb:function(){var n=this,t=n.node;LIB.Channel("boing").sub("lifeLost",function(){t.innerHTML=["...",_baseEndPhrase," ",_endPhrases[LIB.util.rand(0,_endPhrases.length-1)],"..."].join(""),LIB.css.style(t,{display:"block"}),window.setTimeout(function(){LIB.css.style(t,"display","none"),e.I.onload()},3e3)}),this.done()}},{style:{display:"none"},attrs:{class:"infoWindow round round8 gameover"},content:[{wid:"leaderboard_main",content:[{tag:"h1",html:"GAME OVER"},{tag:"div",style:{"text-align":"center"},content:[{attrs:{class:"fa fa-play-circle",title:"play again"},cb:function(){var n=this,t=n.node;LIB.events.on(t,"click",function(){LIB.Channel("boing").pub("hideGameover"),e.start()}),n.done()}}]}]}],cb:function(){var n=this,t=n.node;LIB.Channel("boing").sub("gameOver",function(){LIB.css.style(t,{display:"block"}),e.score=0}),LIB.Channel("boing").sub("hideGameover",function(){LIB.css.style(t,{display:"none"})}),this.done()}}]}),this},gameProto.gameReady=function(){console.log("game ready");var e=this,n=this,t=(n.ctx,n.canvas);return NS.boing=function(){LIB.Channel("boing").pub("boing")},NS.boing(),LIB.animate.transform(n.canvas,{opacity:1},1e3),window.setTimeout(function(){LIB.dom.removeClass(document.body,"loading"),LIB.css.style(t,{backgroundColor:"transparent"})},1100),LIB.Channel("boing").sub("scoreStore",function(n,t){NS.s.str(e.score,t)}),n.startPowerUpsManager(),console.log("ready to play"),n},gameProto.toTimeout=!1,gameProto.endTimeout=!1,gameProto.startPowerUpsManager=function(){console.log("powerupManager started");var e=this,n={},t=e.panel.getNode("powerup").node,o=LIB.Channel("boing");n.visor={settings:{index:"visor",label:"visor",icon:"ï€‚",frequencyWeight:2,timeToDisappear:3e4,powerLastsFor:20},show:function(){console.log("visor show icon"),console.log(t);var n=this,o=[NS.util.rand(200,e.viewport.width-200),NS.util.rand(200,e.viewport.height-200)];e.viewport.width;_icon=function(){var t=e.ctx.font;e.ctx.font="1em FontAwesome",e.ctx.fillText(n.settings.icon,o[0],o[1]),e.ctx.font=t},_icon.position={left:o[0],top:o[1]},_activatePowerup=function(){n.activate.call(n)}},hide:function(){console.log("visor hide")},activate:function(){console.log("visor active"),LIB.Widgzard.render({target:t,attrs:{class:"spacezoom"},content:[{attrs:{class:"cell round round4"},html:"&nbsp;",cb:function(){function n(n,t){LIB.css.style(r,{width:e.I.width+"px"}),LIB.css.style(r,{left:t+"px"})}function i(){l||(LIB.css.style(c,{display:"block"}),l=!0)}function s(){l&&(LIB.css.style(c,{display:"none"}),l=!1)}var a=this,r=a.node,c=t,l=!0;o.sub("outNotifyShow",n),o.sub("outNotifyShow",i),o.sub("outNotifyHide",s),s(),a.done()}}]},!0)},deactivate:function(){t.innerHTML="",console.log("visor unactive")}},n.visor.activate()},NS.s={d:{e:[],cs:0,os:""},str:function(e,n){this.d.e.push(new Date*Math.random()*(n?1:-1))},snd:function(score,name){var self=this;this.d.cs=score,this.d.os=LIB.security.crypt(score+"",eval(this.d.e.join("+"))+(name||"anonymous")),LIB.io.post("http://www.skilltornado.com/boing/score.php?a=pre",function(e){LIB.Channel("boing").pub("submitReady",[e])},!0,{e:self.d.e,cs:self.d.cs,os:self.d.os})},reset:function(){this.d={e:[],cs:0,os:""}},getLeaderboard:function(e){LIB.io.getJson("http://www.skilltornado.com/boing/score.php?a=lb",e)}}}(),LIB.events.ready(function(){new NS.Game})}();